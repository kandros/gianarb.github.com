<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-language" content="en">
    <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Docker inside docker and overview about Jenkins 2</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="A little overview about Jenkins 2 but the main topic of the article is about how run docker inside docker to start a continuous integration system inside a container">
    <meta name="keywords" content="docker, ci, automation, devops, jenkins, container, docker captain">
    <meta name="google-site-verification" content="FoOIQ005srOjHlH19pNWapHvlOOVgCqHsz47IfQ6QNo" />
    <link rel="canonical" href="https://gianarb.it/blog/docker-inside-docker-and-jenkins-2">
    <link rel="icon" type="image/png" href="/img/favicon.png" />

    <meta name='twitter:card' content='summary_large_image'>
    <meta name='twitter:title' content="Docker inside docker and overview about Jenkins 2">
    <meta name='twitter:description' content="A little overview about Jenkins 2 but the main topic of the article is about how run docker inside docker to start a continuous integration system inside a container">

    <meta property="og:title" content="Docker inside docker and overview about Jenkins 2" />
    <meta property="og:site_name" content="gianarb blog"/>
    <meta property="og:url" content="https://gianarb.it/blog/docker-inside-docker-and-jenkins-2" />
    <meta property="og:description" content="A little overview about Jenkins 2 but the main topic of the article is about how run docker inside docker to start a continuous integration system inside a container" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    <meta property="og:image" content="https://gianarb.it/img/docker.png" />
    <meta name='twitter:image' content="https://gianarb.it/img/docker.png">



    <meta property="twitter:account_id" content="129952408" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@gianarb">
    <meta name="twitter:creator" content="@gianarb">
    <meta name="twitter:title" content="Docker inside docker and overview about Jenkins 2">
    <meta name="twitter:description" content="A little overview about Jenkins 2 but the main topic of the article is about how run docker inside docker to start a continuous integration system inside a container">
    <meta name="twitter:image:src" content="https://gianarb.it/img/docker.png">
    <meta name="twitter:image:width" content="500">
    <meta name="twitter:image:height" content="500">
    <meta name="twitter:domain" content="gianarb.it">

    <link rel='alternate' type='application/atom+xml' title='Atom 0.3' href='/atom.xml'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" rel="stylesheet">

    <!-- source https://github.com/rsms/inter/ -->
    <link href="/fonts/inter/inter-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">

</head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark" role="navigation">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-brand" href="#">
        <a href="/" class="nav-link">
          <img src="/img/favicon.png" class="img-fluid d-inline-block align-top" alt="">
        </a>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li><a class="nav-link" href="/">Home</a></li>
          <li><a class="nav-link" href="/blog.html">Blog</a></li>
          <li class="nav-item"><a href="/conferences.html" class="nav-link">Conferences</a></li>
        </ul>

        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7DLK7L&placement=gianarbit" id="_carbonads_js"></script>
          </li>
        </ul>

      </div>

    </div>
</nav>

        

<div class="container">

    <div class="content">

        <div class="row">
            <div id="post-title" class="mt-5 col-md-12">
                <h1>Docker inside docker and overview about Jenkins 2</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <p class="meta">01 Apr 2016 · <!-- thanks to https://www.davidputney.com/2016/07/how-medium-style-read-time-estimate.html -->


<span class="blog-read-time">Three minute read</span>
 · docker, ci, automation, devops, jenkins, container, docker captain</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="addthis_sharing_toolbox"></div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
            <blockquote class="twitter-tweet tw-align-center" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/docker?src=hash">#docker</a> inside docker
and an overview about Jenkins 2 <a href="https://t.co/qa5ddjfhrs">https://t.co/qa5ddjfhrs</a> <a href="https://twitter.com/docker">@docker</a> <a href="https://twitter.com/jenkinsci">@jenkinsci</a> <a href="https://twitter.com/hashtag/container?src=hash">#container</a></p>&mdash;
Gianluca Arbezzano (@GianArb) <a href="https://twitter.com/GianArb/status/727876226875068416">May 4,
2016</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Jenkins  is one of the most famous
continuous integration and deployment tools, it’s written in Java and it helps
you to manage your pipeline and all tasks that help you to put your code in
production or manage your build.</p>

<p>The announcement of Jenkins release of version 2 few days ago, is one of the
best release of this year in my opinion.</p>

<p>The previous version is very stable but it has a lot of years and the ecosystem
is totally different. I am happy to see a strong refurbishment to get the best
of this powerful tool with a series of new feature like:</p>

<ul>
  <li>Nice installation wizard</li>
  <li>Refactoring of the design, one of the most critical
feature of the previous version</li>
  <li>Good and modern set of plugins like <a href="https://jenkins.io/solutions/pipeline/">Jenkins
Pipeline</a> to manage your build</li>
</ul>

<p>Jenkins is truly a wonder but the tool of the moment it’s docker, engine
that allow you to work easier with the containers.</p>

<p>This two tools together are perfect to create an isolated environment to test
and deploy your applications.</p>

<p>The first setup could be install Jenkins on your
server and use a plugin to manage the integration and trigger your test inside
an isolated environment, the container.</p>

<p>Great work but in my opinion reproducibility is one of the critical point when
you deal with plugins if you can not run your build on your local environment
easily then you have a problem.  Secondly if the container could be a good
solution to deploy and maintain a solid and isolated application, why your
Jenkins has not the privilege to run inside a container?  In this perspective
how can we run container inside a container?</p>

<p>Ok, now its the time to figure it out how to solve the problems.</p>

<p>We can use the official Jenkins image to put jenkins inside a container, but I
worked on my personal alpine installation, light and easy, <a href="https://github.com/gianarb/dockerfile/blob/master/jenkins/2.0/Dockerfile">here is the
dockerfile</a>
and we can pull it:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">docker pull gianarb/jenkins:2.0</code></pre></figure>

<p>If you are interested the main article to understand how run docker inside
docker is written by
<a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/">jpetazzo</a>,
the idea is run our jenkins container with <code class="highlighter-rouge">-privileged</code> enabled and share our
docker binary and the socket <code class="highlighter-rouge">/var/run/docker.sock</code> to manage our
communications.</p>

<ul>
  <li><code class="highlighter-rouge">/var/run/docker.sock</code> is the entrypoint of the docker daemon</li>
  <li><code class="highlighter-rouge">docker</code> the command is like a client that sends commands to socket</li>
  <li><code class="highlighter-rouge">--privileged</code> give extended privileges to our container</li>
</ul>

<p>Translated in a docker command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">docker run <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">$(</span>which docker<span class="k">)</span>:/usr/local/bin/docker <span class="se">\</span>
    <span class="nt">-p</span> 5000:5000 <span class="nt">-p</span> 8080:8080 <span class="se">\</span>
    <span class="nt">-v</span> /data/jenkins:/var/jenkins <span class="se">\</span>
    <span class="nt">--privileged</span> <span class="se">\</span>
    <span class="nt">--restart</span> always <span class="se">\</span>
    gianarb/jenkins:2.0</code></pre></figure>

<p>We connect on <code class="highlighter-rouge">http://docker-ip:8080</code> and start the new awesome wizard!</p>

<p><img class="img-fluid" alt="First Jenkins 2 page, grab from the log your key and start" src="/img/docker-in-docker/jenkins2-start.png" /></p>

<p><img class="img-fluid" alt="Jenkins's plugins wizard" src="/img/docker-in-docker/jenkins2-plugin.png" /></p>

<p>To verify that all work we can create a new job it only runs <code class="highlighter-rouge">docker ps -a</code> our
expectation is the same list of containers that we have out of jenkins.</p>

<p><img class="img-fluid" alt="Result of the first build" src="/img/docker-in-docker/jenkins2-result.png" /></p>

<p>Now we can use run command from jenkins to manage our build with docker without
any kind of plugins but anyway you are free to use <a href="https://wiki.jenkins-ci.org/display/JENKINS/Docker+Plugin">Docker
Plugin</a> to start
your build.</p>

<p>I used Jenkins like an example to run docker inside another container but you
can use the same strategy to do the same with your applications if they require
a strong connection with docker.</p>

            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <div id="disqus_thread"></div>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </div>

    </div>
</div>

<script>
var disqus_config = function () {
    this.page.url = 'https://gianarb.it/blog/docker-inside-docker-and-jenkins-2';
    this.page.identifier = 'https://gianarb.it/blog/docker-inside-docker-and-jenkins-2';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://gianarbdeveloper.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

        <div class="footer text-center bg-dark text-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12 small">
                last update December 22, 2020 ·
                <a href="https://twitter.com/gianarb" target="_blank">twitter.com/gianarb</a> ·
                <a href="https://github.com/gianarb" target="_blank">github.com/gianarb</a> ·
                <a href="https://twitch.tv/gianarb" target="_blank">twitch.tv/gianarb</a> ·
                <a href="/atom.xml">Atom</a>
            </div>
        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/dockerfile.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/go.min.js"></script>
        <script src="/js/custom.js"></script>

        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
