<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-language" content="en">
    <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>About your images, security tips</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Everything unnecessary in your system could be a very stupid vulnerability. We already spoke about this idea in the capability chapter and  the same rule exists when we build an image. Having  tiny images with only what our application needs to run is not just a goal in terms of distribution but also in terms of cost of maintenance and security.">
    <meta name="keywords" content="docker, scaledocker, book, docker captain, ebook, security">
    <meta name="google-site-verification" content="FoOIQ005srOjHlH19pNWapHvlOOVgCqHsz47IfQ6QNo" />
    <link rel="canonical" href="https://gianarb.it/blog/about-your-images-security-tips">
    <link rel="icon" type="image/png" href="/img/favicon.png" />

    <meta name='twitter:card' content='summary_large_image'>
    <meta name='twitter:title' content="About your images, security tips">
    <meta name='twitter:description' content="Everything unnecessary in your system could be a very stupid vulnerability. We already spoke about this idea in the capability chapter and  the same rule exists when we build an image. Having  tiny images with only what our application needs to run is not just a goal in terms of distribution but also in terms of cost of maintenance and security.">

    <meta property="og:title" content="About your images, security tips" />
    <meta property="og:site_name" content="gianarb blog"/>
    <meta property="og:url" content="https://gianarb.it/blog/about-your-images-security-tips" />
    <meta property="og:description" content="Everything unnecessary in your system could be a very stupid vulnerability. We already spoke about this idea in the capability chapter and  the same rule exists when we build an image. Having  tiny images with only what our application needs to run is not just a goal in terms of distribution but also in terms of cost of maintenance and security." />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    <meta property="og:image" content="https://gianarb.it/img/container-security.png" />
    <meta name='twitter:image' content="https://gianarb.it/img/container-security.png">



    <meta property="twitter:account_id" content="129952408" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@gianarb">
    <meta name="twitter:creator" content="@gianarb">
    <meta name="twitter:title" content="About your images, security tips">
    <meta name="twitter:description" content="Everything unnecessary in your system could be a very stupid vulnerability. We already spoke about this idea in the capability chapter and  the same rule exists when we build an image. Having  tiny images with only what our application needs to run is not just a goal in terms of distribution but also in terms of cost of maintenance and security.">
    <meta name="twitter:image:src" content="https://gianarb.it/img/container-security.png">
    <meta name="twitter:image:width" content="500">
    <meta name="twitter:image:height" content="500">
    <meta name="twitter:domain" content="gianarb.it">

    <link rel='alternate' type='application/atom+xml' title='Atom 0.3' href='/atom.xml'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" rel="stylesheet">

    <!-- source https://github.com/rsms/inter/ -->
    <link href="/fonts/inter/inter-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">

</head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark" role="navigation">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-brand" href="#">
        <a href="/" class="nav-link">
          <img src="/img/favicon.png" class="img-fluid d-inline-block align-top" alt="">
        </a>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li><a class="nav-link" href="/">Home</a></li>
          <li><a class="nav-link" href="/blog.html">Blog</a></li>
          <li class="nav-item"><a href="/conferences.html" class="nav-link">Conferences</a></li>
        </ul>

        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7DLK7L&placement=gianarbit" id="_carbonads_js"></script>
          </li>
        </ul>

      </div>

    </div>
</nav>

        

<div class="container">

    <div class="content">

        <div class="row">
            <div id="post-title" class="mt-5 col-md-12">
                <h1>About your images, security tips</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <p class="meta">28 Dec 2016 · <!-- thanks to https://www.davidputney.com/2016/07/how-medium-style-read-time-estimate.html -->


<span class="blog-read-time">Three minute read</span>
 · docker, scaledocker, book, docker captain, ebook, security</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="addthis_sharing_toolbox"></div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
            <p>Everything unnecessary in your system could be a very stupid vulnerability. We
already spoke about this idea in the capability chapter and  the same rule
exists when we build an image. Having  tiny images with only what our
application needs to run is not just a goal in terms of distribution but also
in terms of cost of maintenance and security.  If you have some small
experience with docker already you probably know the
<a href="https://hub.docker.com/_/alpine/">alpine</a> image. It is build
from the Alpine distribution and it’s only 5MB size, if your application can
run inside it then this is a very good optimization that you can do.  What
about your binaries? Can your application run standalone? If the answer is yes
you can think about a very very minimal image. scratch is usually used as a
base for other images like debian and ubuntu but you can also use it to run
your golang binary and let me show you something with our micro application.
In the <a href="https://github.com/gianarb/micro/releases/tag/1.0.0">release page</a>,
there are a list of binaries already compiled and ready to be used. In this
case we can download the linux_386 binary.</p>

<p><img class="img-fluid" src="/img/security-image/micro-release.png" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-SsL</span> https://github.com/gianarb/micro/releases/download/1.0.0/micro_1.0.0_linux_386 <span class="o">&gt;</span> micro
</code></pre></div></div>

<p>And we know we can include this binary in the scratch image with this Dockerfile</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM scratch

ADD ./micro /micro
EXPOSE 8000

CMD <span class="o">[</span><span class="s2">"/micro"</span><span class="o">]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> micro-scratch <span class="nb">.</span>
docker run <span class="nt">-p</span> 8000:8000 micro-scratch
</code></pre></div></div>

<p>The expectation is an http application on port 8000 but the main difference is
the size of the image, the old one from alpine is 12M the new one is 5M.</p>

<p>The scratch image is impossibile to use with all applications but if you have a
binary you can remove a lot of unused overhead.</p>

<p>Another way to understand the status of your image is to scan it to detect
security vulnerabilities or exposures. Docker Hub and Docker Cloud can do it
for private images.  This is a great feature to have in your pipeline to scan
an image after a build.</p>

<p>CoreOS provides an open source project called <a href="https://github.com/coreos/clair">clair</a> to do the same in your environment.</p>

<p>It is an application in Golang that exposes a set of HTTP API to
pull, push and analyse images. It downloads vulnerabilities from different
sources like <a href="https://security-tracker.debian.org/tracker">Debian Security
Tracker</a> or <a href="https://www.redhat.com/security/data/metrics/">RedHat Security
Data</a>. Each vulnerability is
stored in Postgres. Clair works like static analyzer, this means that it
doesn’t need to run our container to scan it but it persists different checks
directly into the filesystem of the image.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-p</span> 5000:5000 registry
</code></pre></div></div>

<p>With this command we are running a private registry to use as a source for the
image to scan</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull gianarb/micro:1.0.0
docker tag gianarb/micro:1.0.0 localhost:5000/gianarb/micro:1.0.0
docker push localhost:5000/gianarb/micro:1.0.0
</code></pre></div></div>

<p>Now that we pushed in our private repo the micro image we can setup clair.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir <span class="nv">$HOME</span>/clair-test/clair_config
<span class="nb">cd</span> <span class="nv">$HOME</span>/clair-test
curl <span class="nt">-L</span> https://raw.githubusercontent.com/coreos/clair/v1.2.2/config.example.yaml <span class="nt">-o</span> clair_config/config.yaml
curl <span class="nt">-L</span> https://raw.githubusercontent.com/coreos/clair/v1.2.2/docker-compose.yml <span class="nt">-o</span> docker-compose.yml
</code></pre></div></div>
<p>Modify <code class="highlighter-rouge">$HOME/clair_config/config.yml</code> and add the proper source
<code class="highlighter-rouge">postgresql://postgres:password@postgres:5432?sslmode=disable</code></p>

<p>Now you can run the following command to start postgres and clair:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up
</code></pre></div></div>

<p>To make our test easier, we will use another CLI called hyperclair that is just
a client to work with this application. If you are using Mac OS, you can follow
the above commands, if you are in another OS you can find the correct url in
the release page</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-SSl</span> https://github.com/wemanity-belgium/hyperclair/releases/download/0.5.2/hyperclair-darwin-386 <span class="o">&gt;</span> ~/hyperclair
chmod 755 ~/hyperclair
</code></pre></div></div>

<p>Now we have an executable in ~/hyperclair</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/hyperclair pull localhost:5000/gianarb/micro:1.0.0
~/hyperclair push localhost:5000/gianarb/micro:1.0.0
~/hyperclair analyze localhost:5000/gianarb/micro:1.0.0
~/hyperclair report localhost:5000/gianarb/micro:1.0.0
</code></pre></div></div>

<p>The generated report looks like this:</p>

<p><img class="img-fluid" src="/img/security-image/report-clair.png" /></p>

<p>Hyperclair is just one of the implementations of clair, you can decide to use
it or build your own implementation in your pipeline.</p>

            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <div id="disqus_thread"></div>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </div>

    </div>
</div>

<script>
var disqus_config = function () {
    this.page.url = 'https://gianarb.it/blog/about-your-images-security-tips';
    this.page.identifier = 'https://gianarb.it/blog/about-your-images-security-tips';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://gianarbdeveloper.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

        <div class="footer text-center bg-dark text-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12 small">
                last update December 22, 2020 ·
                <a href="https://twitter.com/gianarb" target="_blank">twitter.com/gianarb</a> ·
                <a href="https://github.com/gianarb" target="_blank">github.com/gianarb</a> ·
                <a href="https://twitch.tv/gianarb" target="_blank">twitch.tv/gianarb</a> ·
                <a href="/atom.xml">Atom</a>
            </div>
        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/dockerfile.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/go.min.js"></script>
        <script src="/js/custom.js"></script>

        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
