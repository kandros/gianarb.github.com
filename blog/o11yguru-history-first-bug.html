<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-language" content="en">
    <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>o11y.guru the history of the first bug</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Part of the o11y.guru series this is about the first bug I discovered with the help of honeycomb and how I had to fix it twice in order to make it to work.">
    <meta name="keywords" content="o11y.guru, bug, honeycomb, twitter">
    <meta name="google-site-verification" content="FoOIQ005srOjHlH19pNWapHvlOOVgCqHsz47IfQ6QNo" />
    <link rel="canonical" href="https://gianarb.it/blog/o11yguru-history-first-bug">
    <link rel="icon" type="image/png" href="/img/favicon.png" />

    <meta name='twitter:card' content='summary_large_image'>
    <meta name='twitter:title' content="o11y.guru the history of the first bug">
    <meta name='twitter:description' content="Part of the o11y.guru series this is about the first bug I discovered with the help of honeycomb and how I had to fix it twice in order to make it to work.">

    <meta property="og:title" content="o11y.guru the history of the first bug" />
    <meta property="og:site_name" content="gianarb blog"/>
    <meta property="og:url" content="https://gianarb.it/blog/o11yguru-history-first-bug" />
    <meta property="og:description" content="Part of the o11y.guru series this is about the first bug I discovered with the help of honeycomb and how I had to fix it twice in order to make it to work." />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    <meta property="og:image" content="https://gianarb.it/img/gianarb.png" />
    <meta name='twitter:image' content="https://gianarb.it/img/gianarb.png">



    <meta property="twitter:account_id" content="129952408" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@gianarb">
    <meta name="twitter:creator" content="@gianarb">
    <meta name="twitter:title" content="o11y.guru the history of the first bug">
    <meta name="twitter:description" content="Part of the o11y.guru series this is about the first bug I discovered with the help of honeycomb and how I had to fix it twice in order to make it to work.">
    <meta name="twitter:image:src" content="https://gianarb.it/img/gianarb.png">
    <meta name="twitter:image:width" content="500">
    <meta name="twitter:image:height" content="500">
    <meta name="twitter:domain" content="gianarb.it">

    <link rel='alternate' type='application/atom+xml' title='Atom 0.3' href='/atom.xml'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" rel="stylesheet">

    <!-- source https://github.com/rsms/inter/ -->
    <link href="/fonts/inter/inter-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">

</head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark" role="navigation">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-brand" href="#">
        <a href="/" class="nav-link">
          <img src="/img/favicon.png" class="img-fluid d-inline-block align-top" alt="">
        </a>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li><a class="nav-link" href="/">Home</a></li>
          <li><a class="nav-link" href="/blog.html">Blog</a></li>
          <li class="nav-item"><a href="/conferences.html" class="nav-link">Conferences</a></li>
        </ul>

        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7DLK7L&placement=gianarbit" id="_carbonads_js"></script>
          </li>
        </ul>

      </div>

    </div>
</nav>

        

<div class="container">

    <div class="content">

        <div class="row">
            <div id="post-title" class="mt-5 col-md-12">
                <h1>o11y.guru the history of the first bug</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <p class="meta">07 Nov 2019 · <!-- thanks to https://www.davidputney.com/2016/07/how-medium-style-read-time-estimate.html -->


<span class="blog-read-time">Five minute read</span>
 · o11y.guru, bug, honeycomb, twitter</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="addthis_sharing_toolbox"></div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
            <div class="jumbotron">

  <h2 id="introduction">Introduction</h2>

  <p>This article is part of a series I am writing about a
side project I made called <a href="https://o11y.guru">o11y.guru</a>. Who knows what this
series or the project itself will become. The reason why I started it was to
have my <strong>wonderland</strong>. A place where I was able to do my mistakes without any
intermediary.</p>

  <p>This series is about my journey there. I will keep the this <code class="highlighter-rouge">Introduction</code>
common to all the articles part of this series and I will keep a <code class="highlighter-rouge">Table of
Content</code> up to date. The best way to follow my journey here is to subscribe to
the RSS feed or to follow me on <a href="https://twitter.com/gianarb">@twitter</a>.</p>

  <h3 id="what-is-this-project">what is this project?</h3>

  <p>I had this idea to create a mechanism to enable other people that uses twitter
to follow a group of leaders in a particular space. I decided to start from the
observability (#o11y) because it is the area where I am in at the moment.</p>

  <p><a href="https://o11y.guru">o11y.guru</a> is pretty simple, a list of faces and a
button, they you press it and if you will authorize the twitter application you
will get to follow them.</p>

  <h3 id="table-of-content">Table of Content</h3>

  <ol>
    <li><a href="/blog/o11yguru-introduction">First day and first set of iterations</a></li>
    <li>Build process and automation driven by simplicity</li>
    <li>Monitoring and instrumentation with Honeycomb</li>
    <li><a href="/blog/o11yguru-history-first-bug">The history of the first bug</a></li>
    <li>OpenTelemetry it is time to embrace a unicorn standard</li>
    <li>The magic of structured logging</li>
    <li>Infrastructure monitoring with InfluxCloud</li>
    <li>Infrastructure as code with Terraform and CherryServer. First deploy.</li>
    <li>FAQ</li>
  </ol>

</div>

<h2 id="the-history-of-the-first-bug">The history of the first bug</h2>

<p>After the first deploy I used my twitter account
<a href="https://twitter.com/dev_campy">@gianarb</a> and
<a href="https://twitter.com/dev_campy">@devcampy</a> to try the application. I have also
asked a friend to try it out.</p>

<p>So far so good, the way I coded the following workflow is very basic, and
probably it will quickly reach its scalability limit. It is a loop with a
<code class="highlighter-rouge">time.Sleep(5 * time.Second)</code> break between each account to avoid the Twitter
rate limit.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="x">
</span><span class="k">for</span><span class="x"> </span><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">guru</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">gurus</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">5</span><span class="x"> </span><span class="o">*</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span><span class="x">
    </span><span class="n">err</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">newFriendship</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="n">twitterClient</span><span class="p">,</span><span class="x"> </span><span class="n">guru</span><span class="p">)</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">logger</span><span class="o">.</span><span class="n">Warn</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span><span class="x"> </span><span class="n">zap</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>No retry or things like that for now. Very simple. I hope to iterate on it in
the future when it will start to not working well enough anymore.</p>

<p>It does not report any error if the Twitter API request to follow a person
fails, it just go to the next one. All three tests went well for what I was able
to say, all three accounts followed the gurus.</p>

<p>One of the first benefit about using HoneyComb is that out of the box they are
able to detect errors looking at the events you return and the graph is made by
them. Just clicking around to their UI I ended up with weirdness like this graph:</p>

<p><img src="/img/o11y-guru-series/first-bug-http-status.png" alt="Requests break down by HTTP Status" class="img-fluid" /></p>

<p>I noticed some <code class="highlighter-rouge">500</code> error page, and I do not like that. As you can see
there is an <code class="highlighter-rouge">Error</code> tab, built by Honeycomb again and this is what it showed to me:</p>

<p><img src="/img/o11y-guru-series/first-bug-span-with-error.png" alt="Span with an error" class="img-fluid" /></p>

<p>At this point it is clear to me where the problem is: “You can’t follow
yourself”. It sounds reasonable.</p>

<p>I changed the code and I added a simple <code class="highlighter-rouge">if</code> statement to skip the guru if it is
the person actually following all the other people.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// me comes from above when I validate that the token behaves to a user.</span><span class="x">

</span><span class="k">if</span><span class="x"> </span><span class="n">guru</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="n">me</span><span class="o">.</span><span class="n">ScreenName</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">continue</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>It does not sound trivial at all but when I tried the fix didn’t work.</p>

<p><img src="/img/o11y-guru-series/rambo.jpg" alt="" class="img-fluid" /></p>

<p>I decided to face up the problem differently. <em>Spoiler alert: I didn’t
write any unit test yet. Feel free to leave now.</em></p>

<p>Looking at the trace I knew I had set for every <strong>following request</strong> the guru name
to follow and at the root span I had who required to follow the
gurus. In practice, I had in the root span <code class="highlighter-rouge">required_by=me.ScreenName</code>, and for every
guru its span with their name. The next image has those two
spans side by side:</p>

<ul>
  <li>At the left the span <code class="highlighter-rouge">newFriendship</code> describes a single following action (a
twitter create friendship api request). As you can see it has the <code class="highlighter-rouge">error="you
can't follow yourself"</code> and the <code class="highlighter-rouge">follower_screenname=gianarb</code>.</li>
  <li>The one to the right is the root span, it has the <code class="highlighter-rouge">required_by=GianArb</code> field,
it is the <code class="highlighter-rouge">me.ScreenName</code> variable.</li>
</ul>

<p><img src="/img/o11y-guru-series/first-bug-compare-spans.png" alt="" class="img-fluid" /></p>

<p>Looking at this span the situation is clear, I was comparing <code class="highlighter-rouge">GianArb</code> the
<code class="highlighter-rouge">required_by</code> variable that you see in the right with <code class="highlighter-rouge">gianarb</code>, the
<code class="highlighter-rouge">follower_screenname</code> you see at the left span.</p>

<p>At the end of the story the check needs to be case-insensitive. And that’s how
it is now:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if strings.EqualFold(guru, me.ScreenName) {
    continue
}
</code></pre></div></div>

<p>This is the history of the first but I randomly discovered and I had to fix
twice for <code class="highlighter-rouge">o11y.guru</code>.</p>

            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <div id="disqus_thread"></div>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </div>

    </div>
</div>

<script>
var disqus_config = function () {
    this.page.url = 'https://gianarb.it/blog/o11yguru-history-first-bug';
    this.page.identifier = 'https://gianarb.it/blog/o11yguru-history-first-bug';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://gianarbdeveloper.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

        <div class="footer text-center bg-dark text-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12 small">
                last update December 22, 2020 ·
                <a href="https://twitter.com/gianarb" target="_blank">twitter.com/gianarb</a> ·
                <a href="https://github.com/gianarb" target="_blank">github.com/gianarb</a> ·
                <a href="https://twitch.tv/gianarb" target="_blank">twitch.tv/gianarb</a> ·
                <a href="/atom.xml">Atom</a>
            </div>
        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/dockerfile.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/go.min.js"></script>
        <script src="/js/custom.js"></script>

        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
